1) Первым делом я привиду тестовую среду к привычному для меня виду. Я подниму тестовый контейнер с командой bash и буду подключаться к нему, чтобы выполнить необходимую для меня команду rspec *args
2) Изменим скорость загрузки окружения `time bundle exec bin/rake environment` (9 секунд) и установим bootsnap, чтобы ускорить запуск. Получаю 6 секунд на первый запуск и 3 секунды на последующие. Уже успех. По-хорошему надо создать еще docker-volume, но лень, оставлю пока так
3) Дальше я включу запуск тестов только с тегом :model, чтобы ускорить feedback-loop на начальном этапе
4) Настроим получение метрик по скорости выполнения тестов с помощью influxer и influxdb
5) Запустм тесты на модельки со следующими параметрами SAMPLE_GROUPS=3 TEST_STACK_PROF=1 TEST_STACK_PROF_FORMAT=json
6) Видим BacktraceCleaner, сгенерируем отчет qcachegrind, видим HoneyComb, отключим его для тестового окружения, получаем небольшой прирост производительности
7) найдем самый медленный тест на модельки с помощью rspec --profile. Вижу ./spec/models/article_spec.rb, выполняющийся 3 секунды. Профилирую его с помощью ruby-prof (работает ну ооочень медленно генерация отчета) Ничего интересного не нахожу(((
8) Запущу тот же самый файл с RD_PROF=1. Вижу, что создание article через let занимает 9 секунд из 22 секунд общего выполнения файла
9) Запущу тот же самый файл с FPROF=1 и вижу, что много времени уходит на пользователей и на статьи, но на пользователей сильно больше
10) Включил в тестах use_transactional_fixtures, добавил let_it_be, время выполнения article_spec.rb сократилось в 2 раза (с 22 до 13 секунд). Но упала часть тестов. Не хочу заниматься починкой тестов на Dev.to, поэтому с оговоркой скажу, что оптимизация выполнена успешно