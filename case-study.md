# Оптимизация времени тестирования моделей Dev.to
Наша компания является одним из тех редких исключений, где тесты не пишутся в угоду скорости разработки, поэтому был выбран dev.to в качестве тестового полигона.

## Описание проблемы
Общая продолжительность выполнения всех тестов занимает около 10 минут, что слишком много для ожидания. Поэтому было решено попытаться сократить это время путем оптимизации тестов, занимающих самое продолжительное время. Для того, чтобы не использовать примеры, показанные в задании, было решено сосредоточиться лишь на тестах моделей и оптимизировать самые долгие из них.

До оптимизации время на тестирование всех моделей занимало 2 минуты 15 секунд.
При помощи `rspec --profile`, `RD_PROF=1 rspec` и `FPROF=1 rspec` было выделены самые долгие тесты моделей, которые и было решено ускорять. В качестве метрики было выбрано время тестирования всех моделей, и выставлен бюджет метрики в 45 секунд - ускорение тестов в три раза.

## Feedback-loop
Для оптимизации прогона тестов был разработан следующий `feedback-loop`: -Профилирование
-Оптимизация кода
-Замер времени и корректности работы теста

### Оптимизация создания объектов с помощью фабрик
Вершины на графике соответствуют следуюшим шагам:

1. Выставил логгирование в значение :fatal.
2. Перевел тестирование в параллельный режим с помощью `rake spec[3]`
3. Добавил `allow_http_connections_when_no_cassette` в инициализатор `VCR`, так как без него начали полностью падать тесты с `let_it_be`

В самых долгих тестах заменил где это возможно `let` на `let_it_be`. В каких-то случаях пришлось внести в тесты дополнительные изменения.

4. Оптимизация `comment_spec`
5. Оптимизация `notification_spec`
6. Оптимизация `reaction_spec`
7. Оптимизация `tag_ajustment_spec`
8. Оптимизация `user_spec`
9. Оптимизация `article_spec`
10. Убрал генерацию картинок в фабрике `User`, удалил создание `identity` для юзера и перенес ее в конкретный тест.

### Выводы
Благодоря оптимизации, время тестирования моделей удалось уложить в заданный бюджет и составило 41 секунду (хронограф показывает завышенное время) без потери тестового покрытия.
