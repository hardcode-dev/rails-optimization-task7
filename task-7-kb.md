### Домашнее задание №7
Вообще я готовил это к 8му заданию, но сейчас очень не хватает времени да и вроде бы можно в 7-м задание так же показать.

### Ускорение DX на рабочем проекте.
Кратко о рабочем проекте (больше распишу к заданию 8) - относительный монолит из 2 больших приложений (и кучи мелких + новые микросервисы)
У обоих приложений единая БД, есть обшая логика и обшие сушности (все это шарится через подключение обшего тома). Много легаси не покрытого тестами, весь новый код покрыт в рамках основных кейсов.

1. Определимся с начальной точкой и бюджетом, а так же основной метрикой.
Замерим начальное время прогона тестов для локальной разработки для основной платформы.
Finished in 5 minutes 24.6 seconds (files took 58.21 seconds to load)
Общее время прогона тестов около 5 минут, их них 50 секунд - минута занимает подгрузка общих файлов. Исходя из этого будем отталкиватся.
Попробуем уйти от 5 минут и будем считать их бюджетом.

2. Для начал попробуем срезать преславутые 50 секунд для подгрузки приложения и зависимостей.
Проблема - любой запуск даже одного теста занимает около 50 секунд - минуты.

Время прогона небольшой группы тестов  - Finished in 14.27 seconds (files took 48.64 seconds to load)

Решение: Как оказалось у нас был установлен spring но люди которые его добавили покинули проект, а наша молодая поросль - или боится его использует или не понимает его профита.
Стал запускать тесты через спринг, КПД при разработке повысился. Появился смысл использования guard (но его пока не стал добавлять)

Результаты шага - при повторном запуске снимаем лишние 50 секунд. Гонял так тесты неделю - проблемы использования spring не нашел, попробую еще немного погонять и переубедить коллег. (при чем в CI мы его испоьзуем - ???)
Finished in 4 minutes 24.5 seconds (files took 10.45 seconds to load)

3. Попробуем еще уменьшить время прогона тестов. Посмотрим кто из тестов больше всего занимает времени - через отчет RSpecDissect выберем самые толстые тесты.
Профайлер показал что у нас в 10ке тестов - много тестов на тяжелые рейк таски единичного использования (например пересчет каких либо данных на корркетные после бага).
Промежуточное решение - задисейблить их временно
Правильное решение - вынести в отдельную группу и запускать например только в CI или руками

Результат: Finished in 2 minutes 22.5 seconds (почти в 2 раза упало время прогона)

4. Total `let` time: 01:33.598 - на данный момент основная проблема тестов. Попробуем поработаь с этим.
Да будет let_it_be! 
Результат: Получилось срезать около 30 секунд просто банальной заменой, и правкой пары тестов. При этом есть еще большое поле - перекомпановки всех тестов и еще более значительное уменьшение времени.
Total `let` time: 01:02.032 

Промежуточный итог - прогон приближается к 1 минуте 30 секундам.

5. Поработаем с FactoryDoctor и проанализируем фабрики. 
Отчет показал что у нас не так все плохо но есть ряд пятиэтажек. Попробуем переделать фабрики и убрать лишнее.
Результат - особого прироста не замечано. 

Итоги и неудачные шаги.
1. Попробовал parallel_test - к сожалению в текущем ворк флоу он довольно не удобен (1 - часто бывают миграции и нужно перестраивать дополнительные базы 2 - докер не сильно позволяет его разогнать 3 - так как докер приходится довольно часто на неделе down-ить, время развертывания кажется более приоритетным). 
2. Помечай свои тесты по типу - когда каждый тест помечен гораздо удобнее понять кто жрет больше.
3. Защишай достигнутое - большинство гемов вроде stackprof уже подключено у нас на проекте но мало кто ими пользуется (и я грешной в том числе). Нужны охранительные механизмы что бы не терять прогресс.
4. Chronograph и свой рабочий проект подружить не удалось быстро, поэтому не сделал.

В целом есть еще куда копать, постараюсь все это доделать и вывести хотя бы на уровень review до конца курса, что бы был реальный результат.